<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="club">

    <!-- 회원이 가입한 클럽 목록 조회 쿼리 -->
    <select id="getMemClub" parameterType="String" resultType="club">
        <![CDATA[
            SELECT
                a.clubName,
                a.clubId
            FROM
                club a
                JOIN club_member b ON a.clubId = b.clubId
            WHERE
                b.memberId = #{memberId}
        ]]>
    </select>

    <!-- 클럽 정보 조회 쿼리 -->
  

    <!-- 클럽 정보 조회 쿼리 -->
    <select id="getClubVo" parameterType="int" resultType="club">
        <![CDATA[
            SELECT
                clubId,
                clubName,
                cre_date,
                max,
                preNum,
                intro1,
                intro2,
                address1,
                address2,
                img1,
                img2,
                detailT,
                detailL,
                detailP,
                detailE,
                detailW
            FROM
                club
            WHERE
                clubId = #{clubId}
        ]]>
    </select>

    <!-- 클럽 생성 쿼리 -->
    <insert id="insertClub" parameterType="com.firmeet.vo.ClubVo">
        <selectKey resultType="int" order="BEFORE" keyProperty="clubId">
            SELECT seq_clubId.nextval FROM dual
        </selectKey>
        <![CDATA[
            INSERT INTO club (
                clubId,
                clubName,
                cre_date,
                max,
                preNum,
                intro1,
                intro2,
                address1,
                address2,
                detailT,
                detailL,
                detailP,
                detailE,
                detailW,
                img1,
                img2
            )
            VALUES (
                #{clubId},
                #{clubName},
                sysdate,
                #{max},
                1,
                #{intro1},
                #{intro2},
                #{address1},
                #{address2},
                #{detailT},
                #{detailL},
                #{detailP},
                #{detailE},
                #{detailW},
                #{img1},
                #{img2}
            )
        ]]>
    </insert>
    
       <!-- 클럽 정보 조회 쿼리 -->
      <select id="clubSum"  parameterType="int" resultType="com.firmeet.vo.ClubVo">
        <![CDATA[
            SELECT
            	clubId,
                clubName,
                intro1,
                img2
            FROM
                club
        ]]>
    </select>

    <!-- 클럽 카테고리 정보 삽입 쿼리 -->
    <insert id="insertClubCate" parameterType="com.firmeet.vo.CategoryVo">
        <![CDATA[
            INSERT INTO club_category (clubCateNo, clubId, cateNo)
            VALUES (SEQ_CLUB_CATEGORY_NO.nextval, #{clubId}, #{cateNo})
        ]]>
    </insert>

    <!-- 클럽 태그 정보 삽입 쿼리 -->
    <insert id="insertClubTag" parameterType="com.firmeet.vo.TagVo">
        <![CDATA[
            INSERT INTO club_tag (clubTagNo, clubId, tagNo)
            VALUES (SEQ_CLUB_TAGNO.nextval, #{clubId}, #{tagNo})
        ]]>
    </insert>

    <!-- 클럽 관리자 정보 삽입 쿼리 -->
    <insert id="insertAdmin" parameterType="com.firmeet.vo.ClubMemVo">
        <![CDATA[
            INSERT INTO club_member (clubMemNo, memberId, clubId, memLevel, joinDate)
            VALUES (SEQ_CLUB_MEMNO.nextVal, #{memberId}, #{clubId}, 0, sysdate)
        ]]>
    </insert>
    
    <insert id="insertMem"
		parameterType="com.firmeet.vo.ClubMemVo">
     <![CDATA[	
     			INSERT INTO club_member (clubMemNo,memberId,clubId)
     			VALUES (SEQ_CLUB_MEMNO.nextVal, #{memberId},  #{clubId})
      	]]>
	</insert>

    <select id="getClubName" parameterType="board" resultType="String">
        <![CDATA[
            SELECT
                clubName
            FROM
                club
            WHERE
                clubId = #{clubId}
        ]]>
    </select>

    <!-- 클럽 멤버 레벨 확인 쿼리 -->
    <select id="checkMemLevel" parameterType="map" resultType="com.firmeet.vo.ClubVo">
        <![CDATA[
            SELECT
                a.clubid,
                clubname,
                cre_date,
                max,
                img1,
                img2,
                memlevel
            FROM
                club a
                JOIN club_member b ON a.clubid = b.clubid
            WHERE
                a.clubid = #{clubId}
                AND b.memberid = #{memberId}
        ]]>
    </select>
    
    <!-- 해당 클럽에 가입한 사람들의 상위 5개 태그를 가져오는 쿼리문 -->
    <select id  ="ClubTagRank" parameterType = "club" resultType = "tag">
    	<![CDATA[
			select
			    totalCnt
			    ,count as tagCnt
			    ,tagName
			    ,tagNo
			from(
			    select 
			        rownum as rw
			        ,totalcnt
			        ,count
			        ,tagName
			        ,tagNo
			    from(
			            SELECT 
			            (select count(tagNo) from member_tag a join club_member b on a.memberId = b.memberId where b.clubID = 1) as totalcnt,
			            count(b.tagName) as count , b.tagName, b.tagNo
			            FROM member_tag a
			            JOIN tag b ON a.tagNo = b.tagNo
			            JOIN club_member c ON c.memberId = a.memberId
			            WHERE clubId = #{clubId}
			            GROUP BY  b.tagName, b.tagNo
			            order by count desc
			        )
			    )where rw between 1 and 5     
    	]]>
    </select>
    
</mapper>
